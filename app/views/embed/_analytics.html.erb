<script async src="https://www.googletagmanager.com/gtag/js?id=G-80J719XWE5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  const debug = <%= Settings.analytics_debug %>
  gtag('js', new Date());
  // To turn off debug mode, exclude the parameter altogether (cannot just set to false)
  // See https://support.google.com/analytics/answer/7201382?hl=en#zippy=%2Cgoogle-tag-websites
  const args = {
    <%# collection is a custom event parameter for getting an item's parent collection.
    It is sent with every event if populated with a value %>
    'collection': document.querySelector('link[rel="up"]')?.getAttribute('href')
  }
  if (debug) {
    args["debug_mode"] = debug
  }
  gtag('config', 'G-80J719XWE5', args)
</script>
<% if Settings.metrics_api_url %>
<script src="https://unpkg.com/ahoy.js@0.4.3"
  integrity="sha384-s9X57Wbu8jIIErBMhudZJEAS1ZkelgbMI7/HUqsgjFBBm9IXyfbpKQ+ZoWUUvpgE"
  crossorigin="anonymous"></script>
<script>
  // Set up Ahoy
  ahoy.configure({
    visitDuration: 60, // measured in minutes; this is Zenodo's default
    cookieDomain: "stanford.edu",
    urlPrefix: "<%= Settings.metrics_api_url %>",
  });

  // Send a view event with the object's DRUID so that it can be tracked
  // Override the page and url with the location where the object was embedded
  const embedUrl = new URL(new URLSearchParams(window.location.search).get('url'));
  const url = new URL(document.referrer);
  const druid = embedUrl.pathname.split('/').pop();
  const page = url.pathname;
  ahoy.trackView({ url, page, druid });
</script>
<% end %>
